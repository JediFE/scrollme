!function(factory){"function"==typeof define&&define.amd?define(["jquery"],factory):"object"==typeof module&&module.exports?factory(require("jquery")):window.scrollme=factory(jQuery)}(function($){var _this={},$document=$(document),$window=$(window);return _this.body_height=0,_this.body_width=0,_this.viewport_height=0,_this.viewport_width=0,_this.viewport_top=0,_this.viewport_bottom=0,_this.viewport_left=0,_this.viewport_right=0,_this.viewport_top_previous=-1,_this.viewport_left_previous=-1,_this.elements=[],_this.elements_in_view=[],_this.property_defaults={opacity:1,translatex:0,translatey:0,translatez:0,rotatex:0,rotatey:0,rotatez:0,scale:1,scalex:1,scaley:1,scalez:1},_this.scrollme_selector=".scrollme",_this.animateme_selector=".animateme",_this.update_interval=10,_this.easing_functions={linear:function(x){return x},easeout:function(x){return x*x*x},easein:function(x){return 1-(x=1-x)*x*x},easeinout:function(x){return x<.5?4*x*x*x:1-4*(x=1-x)*x*x}},_this.init_events=["load","DOMContentLoaded","page:load","page:change"],_this.init=function(options){var opts=$.extend({},{direction:"vertical"},options);return _this.direction=opts.direction,_this.init_elements(),_this.on_resize(),$window.on("resize orientationchange",function(){_this.on_resize()}),$window.on("load",function(){setTimeout(function(){_this.on_resize()},100)}),setInterval(_this.update,_this.update_interval),!0},_this.init_elements=function(){$(_this.scrollme_selector).each(function(){var element={};element.element=$(this);var effects=[];$(this).find(_this.animateme_selector).addBack(_this.animateme_selector).each(function(){var effect={};effect.element=$(this),effect.when=effect.element.data("when"),effect.from=effect.element.data("from"),effect.to=effect.element.data("to"),effect.element.is("[data-crop]")?effect.crop=effect.element.data("crop"):effect.crop=!0,effect.element.is("[data-easing]")?effect.easing=_this.easing_functions[effect.element.data("easing")]:effect.easing=_this.easing_functions.easeout;var properties={};effect.element.is("[data-opacity]")&&(properties.opacity=effect.element.data("opacity")),effect.element.is("[data-startopacity]")&&(properties.startopacity=effect.element.data("startopacity")),effect.element.is("[data-translatex]")&&(properties.translatex=effect.element.data("translatex")),effect.element.is("[data-translatey]")&&(properties.translatey=effect.element.data("translatey")),effect.element.is("[data-translatez]")&&(properties.translatez=effect.element.data("translatez")),effect.element.is("[data-rotatex]")&&(properties.rotatex=effect.element.data("rotatex")),effect.element.is("[data-rotatey]")&&(properties.rotatey=effect.element.data("rotatey")),effect.element.is("[data-rotatez]")&&(properties.rotatez=effect.element.data("rotatez")),effect.element.is("[data-scale]")&&(properties.scale=effect.element.data("scale")),effect.element.is("[data-scalex]")&&(properties.scalex=effect.element.data("scalex")),effect.element.is("[data-scaley]")&&(properties.scaley=effect.element.data("scaley")),effect.element.is("[data-scalez]")&&(properties.scalez=effect.element.data("scalez")),effect.properties=properties,effects.push(effect)}),element.effects=effects,_this.elements.push(element)})},_this.update=function(){window.requestAnimationFrame(function(){_this.update_viewport_position(),"vertical"==_this.direction?(_this.viewport_top_previous!=_this.viewport_top&&(_this.update_elements_in_view(),_this.animate()),_this.viewport_top_previous=_this.viewport_top):(_this.viewport_left_previous!=_this.viewport_left&&(_this.update_elements_in_view(),_this.animate()),_this.viewport_left_previous=_this.viewport_left)})},_this.animate=function(){for(var elements_in_view_length=_this.elements_in_view.length,i=0;i<elements_in_view_length;i++)for(var element=_this.elements_in_view[i],effects_length=element.effects.length,e=0;e<effects_length;e++){if("vertical"==_this.direction){var effect=element.effects[e];switch(effect.when){case"view":case"span":var start=element.top-_this.viewport_height,end=element.bottom;break;case"exit":var start=element.bottom-_this.viewport_height,end=element.bottom;break;default:var start=element.top-_this.viewport_height,end=element.top}effect.crop&&(start<0&&(start=0),end>_this.body_height-_this.viewport_height&&(end=_this.body_height-_this.viewport_height));var scroll=(_this.viewport_top-start)/(end-start)}else{var effect=element.effects[e];switch(effect.when){case"view":case"span":var start=element.left-_this.viewport_width,end=element.right;break;case"exit":var start=element.right-_this.viewport_width,end=element.right;break;default:var start=element.left-_this.viewport_width,end=element.left}effect.crop&&(start<0&&(start=0),end>_this.body_width-_this.viewport_width&&(end=_this.body_width-_this.viewport_width));var scroll=(_this.viewport_left-start)/(end-start)}var from=effect.from,to=effect.to,length=to-from,scroll_relative=(scroll-from)/length,scroll_eased=effect.easing(scroll_relative),opacity=_this.animate_value(scroll,scroll_eased,from,to,effect,"opacity"),translatey=_this.animate_value(scroll,scroll_eased,from,to,effect,"translatey"),translatex=_this.animate_value(scroll,scroll_eased,from,to,effect,"translatex"),translatez=_this.animate_value(scroll,scroll_eased,from,to,effect,"translatez"),rotatex=_this.animate_value(scroll,scroll_eased,from,to,effect,"rotatex"),rotatey=_this.animate_value(scroll,scroll_eased,from,to,effect,"rotatey"),rotatez=_this.animate_value(scroll,scroll_eased,from,to,effect,"rotatez"),scale=_this.animate_value(scroll,scroll_eased,from,to,effect,"scale"),scalex=_this.animate_value(scroll,scroll_eased,from,to,effect,"scalex"),scaley=_this.animate_value(scroll,scroll_eased,from,to,effect,"scaley"),scalez=_this.animate_value(scroll,scroll_eased,from,to,effect,"scalez");"scale"in effect.properties&&(scalex=scale,scaley=scale,scalez=scale),effect.element.css({opacity:opacity,transform:"translate3d( "+translatex+", "+translatey+", "+translatez+") rotateX( "+rotatex+") rotateY( "+rotatey+") rotateZ( "+rotatez+") scale3d( "+scalex+" , "+scaley+" , "+scalez+" )"})}},_this.animate_value=function(scroll,scroll_eased,from,to,effect,property){var value_default=_this.property_defaults[property];if("opacity"==property&&"startopacity"in effect.properties&&(value_default=effect.properties.startopacity),!(property in effect.properties))return value_default;var value_target=effect.properties[property],forwards=to>from,percentages=property.indexOf("translate")>=0&&"string"==typeof value_target&&"%"==value_target.charAt(value_target.length-1),translate_unit="px";if(percentages&&(value_target=parseFloat(value_target.slice(0,-1),10),translate_unit="%"),scroll<from&&forwards)return value_default;if(scroll>to&&forwards)return value_target;if(scroll>from&&!forwards)return value_default;if(scroll<to&&!forwards)return value_target;var new_value=value_default+scroll_eased*(value_target-value_default);switch(property){case"opacity":new_value=new_value.toFixed(2);break;case"translatex":case"translatey":case"translatez":new_value=new_value.toFixed(0)+translate_unit;break;case"rotatex":case"rotatey":case"rotatez":new_value=new_value.toFixed(1)+"deg";break;case"scale":new_value=new_value.toFixed(3)}return new_value},_this.update_viewport_position=function(){_this.viewport_top=$window.scrollTop(),_this.viewport_bottom=_this.viewport_top+_this.viewport_height,_this.viewport_left=$window.scrollLeft(),_this.viewport_right=_this.viewport_left+_this.viewport_width},_this.update_elements_in_view=function(){_this.elements_in_view=[];for(var elements_length=_this.elements.length,i=0;i<elements_length;i++)"vertical"==_this.direction?_this.elements[i].top<_this.viewport_bottom&&_this.elements[i].bottom>_this.viewport_top&&_this.elements_in_view.push(_this.elements[i]):(_this.elements[i].left>_this.viewport_right?_this.elements[i].element.addClass("scrollme--before"):_this.elements[i].element.removeClass("scrollme--before"),_this.elements[i].left<_this.viewport_right&&_this.elements[i].right>_this.viewport_left?(_this.elements_in_view.push(_this.elements[i]),_this.elements[i].element.addClass("scrollme--active")):_this.elements[i].element.removeClass("scrollme--active"),_this.elements[i].left<=_this.viewport_left&&!$(".scrollme--active").not(_this.elements[i].element).length?_this.elements[i].element.addClass("scrollme--complete"):_this.elements[i].element.removeClass("scrollme--complete"))},_this.on_resize=function(){_this.update_viewport(),_this.update_element_sizes(),_this.update_viewport_position(),_this.update_elements_in_view(),_this.animate()},_this.update_viewport=function(){_this.body_height=$document.height(),_this.viewport_height=$window.height(),_this.body_width=$document.width(),_this.viewport_width=$window.width()},_this.update_element_sizes=function(){for(var elements_length=_this.elements.length,i=0;i<elements_length;i++){var element_height=_this.elements[i].element.outerHeight(),element_width=_this.elements[i].element.outerWidth(),position=_this.elements[i].element.offset();_this.elements[i].height=element_height,_this.elements[i].width=element_width,_this.elements[i].top=position.top,_this.elements[i].left=position.left,_this.elements[i].bottom=position.top+element_height,_this.elements[i].right=position.left+element_width}},_this.destroy_elements=function(){for(var elements_length=_this.elements.length,i=0;i<elements_length;i++){for(var effect_length=_this.elements[i].effects.length,j=0;j<effect_length;j++)_this.elements[i].effects[j].element.css({opacity:"",transform:""});_this.elements[i].effects=[],_this.elements[i].element.removeClass("scrollme--before"),_this.elements[i].element.removeClass("scrollme--active"),_this.elements[i].element.removeClass("scrollme--complete")}_this.elements=[],_this.elements_in_view=[]},_this});
